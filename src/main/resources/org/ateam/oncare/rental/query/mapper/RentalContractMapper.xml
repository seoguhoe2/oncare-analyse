<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.ateam.oncare.rental.query.mapper.RentalContractMapper">

    <resultMap id="ContractRental" type="org.ateam.oncare.rental.command.dto.ResponseContractRentalDTO">
        <id property="id" column="id"/>
        <result property="productName" column="productName"/>
        <result property="beneficiary" column="beneficiary"/>
        <result property="employee" column="employee"/>
        <result property="startDate" column="startDate"/>
        <result property="endDate" column="endDate"/>
        <result property="expectedEndDate" column="expectedEndDate"/>
        <result property="cumulativeRevenue" column="cumulativeRevenue"/>
    </resultMap>

    <select id="selectRentalContract" resultMap="ContractRental">
        <bind name="limitSize" value="page.pageSize + 1" />
        select
        a.id
        , d.name as productName
        , c.name as beneficiary
        , b.name as employee
        , a.start_date as startDate
        , a.end_date as endDate
        , a.expected_date as expectedEndDate
        , a.cumulative_revenue as cumulativeRevenue
        from rental_contract a
        join employee b on a.emp_id = b.id
        join beneficiary c on a.beneficiary_id = c.id
        join m_care_product d on a.product_cd = d.id
        where 1=1
        <if test="cond.contractStatus != 0">
            and a.contract_status_cd = #{cond.contractStatus}
        </if>
        <if test="cond.beneficiaryOrEmployee != null and cond.beneficiaryOrEmployee != ''">
            and (b.name like concat('%', #{cond.beneficiaryOrEmployee} ,'%')
            or c.name like concat('%', #{cond.beneficiaryOrEmployee} ,'%'))
        </if>
        order by a.contract_status_cd asc
        limit #{limitSize}  offset #{page.offset}
    </select>


</mapper>